---
title: "1. Introductie: Waarom Statistiek?"
author: "Lieven Clement"
date: "statOmics, Ghent University (https://statomics.github.io)"
output:
    html_document:
      code_download: true    
      theme: cosmo
      toc: true
      toc_float: true
      highlight: tango
      number_sections: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(include = TRUE, comment = NA, echo = TRUE,
                      message = FALSE, warning = FALSE)
library(tidyverse)
```

# Oksel microbiome voorbeeld

- Okselgeur wordt niet veroorzaakt door het zweet zelf. De geur is afkomstig van specificiek micro-organismen van de groep *Corynebacterium spp.* die het zweet metaboliseren. *Staphylococcus spp.* zijn een andere groep bacteriën die ook abundant zijn in het microbiome van de oksel die zweet metaboliseren naar metabolieten die niet stinken.

- De CMET-groep aan UGENT doet onderzoek naar het transplanteren van de microbiële gemeenschap, het microbiome, om mensen van geurende oksels af te helpen.  

- Voorgestelde therapie
  	1. Verwijder het oksel microbiome met antibiotica
    2. Beïnvloed het oksel microbiome door microbiome te transplanteren van een individue die geen geurende oksels heeft (https://youtu.be/9RIFyqLXdVw)

- Experiment:

    - 20 personen met okselgeur worden in twee behandelingsgroepen ingedeeld:

        - placebo (enkel antibiotica)
        - transplantie (antibiotica en microbiële transplantatie).

    - Het microbiome wordt bemonsterd 6 weken na de behandeling.
    - The relative abundantie van *Staphylococcus spp.* op *Corynebacterium spp.* + *Staphylococcus spp.* in het microbiome wordt gemeten via DGGE (*Denaturing Gradient Gel Electrophoresis*).

---

## Importeer de data

Data in deze cursus wordt verwerkt via het statistisch software pakket R.
Dit pakket laat toe om te leren uit data.
In deze cursus gaan we data eerst exploreren om inzicht te verwerven in de gegevens om die vervolgens statistisch te verwerken.
Vooraleer we hiermee van start kunnen gaan moeten we de data eerst importeren in R.

Via het volgende commando kunnen we enkele regels van een data bestand inlezen om de structuur van het data bestand te weten te komen.

```{r}
read_lines("https://raw.githubusercontent.com/statOmics/sbc20/master/data/armpit.csv")
```

- Gegevens in het bestand zijn door comma's gescheiden.
- Elke rij bevat de gegevens voor 1 proefpersoon
- Verschillende variabelen worden gemeten per persoon en zijn van elkaar gescheiden door een comma. Het bestand is csv formaat: "comma separated values".
- We kunnen bestanden met dit formaat inlezen R via het commando read_csv.
- We slaan de data op in R in het object met naam ap.

```{r}
ap <- read_csv("https://raw.githubusercontent.com/statOmics/sbc20/master/data/armpit.csv")
ap
```

---

## Data Exploratie and beschrijvende Statistiek

- Data exploratie is heel belangrijk om inzicht te krijgen in de data en is een essentiële eerste stap om te leren uit data.
- Het wordt vaak ondergewaardeerd of over het hoofd gezien.

### Beschrijvende statistiek

We vatten de data eerst samen. We berekenen het gemiddelde en de standaard deviatie (een maat voor de spreiding, zie volgende hoofdstukken).
We slaan het resultaat hiervan op in het object apRelSum via `apRelSum <-`.

1. We pipen (via `%>%`) het `ap` dataframe naar de `group_by` functie om de data te groeperen per treatment trt: `group_by(trt)`.
2. We pipen het resultaat naar de `summarize_at` function om de "rel" variable samen te vatten en berekenen hierbij het gemiddelde en standaardafwijking. Omdat we de data eerst hebben gegroepeerd zullen we het gemiddelde en de standaard deviatie berekenen per groep.



```{r}
apRelSum <- ap %>%
  group_by(trt) %>%
  summarize_at("rel",
               list(mean=mean,
                    sd=sd
                    )
                )
```

We tonen vervolgens het resultaat door het object apRelSum aan te roepen

```{r}
apRelSum
```

We kunnen ook een tabel in de webpagina of het pdf bestand integreren via het commando kable van het knitr pakket:

```{r}
knitr::kable(apRelSum)
```

---

### Grafieken

We maken in deze cursus gebruik van het pakket `ggplot2` om grafieken te maken.  
Met de ggplot2 bibliotheek kunnen we gemakkelijk grafieken opbouwen in lagen (layers).
Hierdoor leest de code veel makkelijker.

#### barplot

Bar plots worden heel veel gebruikt in artikels om resultaten weer te geven.

1. We pipen de samengevatte data naar de functie `ggplot`. Dat is de basis van elke ggplot.  We selecteren de variabele met de behandeling trt als x variabele en de variabele met naam mean als y-variabele voor de plot.
We doen dit steeds via de aestetics `aes` functie.   `aes(x=trt,y=mean)`

2. We maken een barplot door een laag toe te voegen via de  `geom_bar` function. De statistiek is `stat="identity"` omdat de hoogte van de bar gelijk is aan de waarde voor y (hier het gemiddelde voor de relatieve abundantie).

3. We voegen foutenvlaggen toe om de onzekerheid op het gemiddelde weer te geven.  We doen dit via de `geom_errorbar` functie en specifiëren het minimum en maximum van de error bar. Het `width` argument wordt gebruikt om de breedte van de error bar smaller te maken dat deze van de bar.

```{r}
apRelSum%>%
  ggplot(aes(x=trt,y=mean)) +
  geom_bar(stat="identity") +
  geom_errorbar(aes(ymin=mean-sd,ymax=mean+sd),width=.2)
```

- Is deze plot informatief??

---

#### boxplots

Zelf vind ik barplots geen goede grafieken:

- Ze zijn niet informatief
- Ze visulariseren een samenvatting van de data door twee punten: `two point summary`: gemiddelde en de standaard deviatie hierop en kunnen beter in een tabel worden opgenomen.
- Ze verbruiken veel ruimte, b.v. van nul tot de kleinste waarde voor de relatieve abundantie) waar geen data in ligt.

Het is beter om de data zo ruw mogelijk voor te stellen zodat we inzicht krijgen in de verdeling van de gegevens.
Hiervoor zullen we ondermeer boxplots gebruiken.

---

```{r fig.align='center',echo=FALSE}
fem <- NHANES::NHANES %>% filter(Gender=="female" & !is.na(DirectChol)) %>% select(DirectChol)
boxplot(fem$DirectChol, ylab="Direct cholesterol",cex.lab=1.5,cex.axis=1.5,cex.main=1.5)
rangeCl<-quantile(fem$DirectChol,c(.25,.75))+c(-1,1)*diff(quantile(fem$DirectChol,c(.25,.75)))*1.5
boxYs<-c(range(fem$DirectChol[fem$DirectChol<=rangeCl[2]&fem$DirectChol>=rangeCl[1]]),quantile(fem$DirectChol,c(.25,.5,.75)),rangeCl[2]+(max(fem$DirectChol)-rangeCl[2])/2)
text(1.3,boxYs,labels=c("wisker","wisker","x25","mediaan","x75","outliers"),pos=4,cex=1.3)
lines(c(1.1,1.3,1.3,1.1),c(rangeCl[2],rangeCl[2]+(max(fem$DirectChol)-rangeCl[2])/2,rangeCl[2]+(max(fem$DirectChol)-rangeCl[2])/2,max(fem$DirectChol)),lty=2)
```

---

We maken nu een boxplot voor de ap data

1. We pipen het `ap` dataframe naar `ggplot`
2. We selecteren de data voor de plot via `ggplot(aes(x=trt,y=rel))`
3. We voegen laag toe voor de boxplot dmv de functie `geom_boxplot()`

```{r}
ap %>%  
  ggplot(aes(x=trt,y=rel)) +
  geom_boxplot()
```


---

Merk op dat we de plot ook op kunnen slaan als een object.

```{r}
apBoxplot <- ap %>%  
  ggplot(aes(x=trt,y=rel)) +
  geom_boxplot()
```

De plot wordt dan niet gemaakt.

Om de plot weer te geven kunnen we het object aanroepen

```{r}
apBoxplot
```

---

- Merk op dat we niet zoveel gegevens hebben. Enkel 10 per groep.

- Het is altijd beter om de data zo ruw mogelijk te tonen!

Omdat er niet zoveel gegevens zijn kunnen we de data toevoegen aan de plot zonder dat die te druk wordt.

- Merk op dat we het argument `outlier.shape` op NA (not available) zetten `outlier.shape=NA` in the `geom_boxplot` functie omdat we anders outliers twee keer weer zullen geven. Eerst via de boxplot laag en daarna omdat we een laag met alle ruwe data toevoegen aan de plot.
- We geven de ruwe data weer via de  `geom_point(position="jitter")` functie. We gebruiken hierbij het argument position='jitter' zodat we wat random ruis toevoegen aan de x-cordinaat zodat de gegevens elkaar niet overlappen.

```{r}
ap %>%  
  ggplot(aes(x=trt,y=rel)) +
  geom_boxplot(outlier.shape=NA) +
  geom_point(position="jitter")
```

Dit is een informatieve plot!

---

Aangezien we de plot ook hebben opgeslagen konden we dit ook doen door de plot op te roepen en nog een laag toe te voegen.

```{r}
apBoxplot +
  geom_point(position="jitter")
```

We hadden het resultaat ook opnieuw op kunnen slaan voor later hergebruik.

```{r}
apBoxplot <- apBoxplot +
  geom_point(position="jitter")
```

---

## Enkele concepten

- Waarom hebben we meer dan 1 subject nodig per groep?

- Wat wordt er bedoelt met de term random en wat zijn de consequenties hiervan?

- Beschouw twee proefopzetten:

1. Een onderzoeker selecteert 20 mannelijke studenten die last hebben van okselgeur van de faculteit.

2. Een onderzoeker selecteert 20 random personen die last hebben van okselgeur van de Belgische populatie.

---

```{r echo=FALSE}
ap2<-ap
hlp<-lm(rel~trt,ap)
ap2$rel<-rnorm(20,mean=hlp$fit-20,sd=sigma(hlp)*2)
```


```{r}
ap %>%  
  ggplot(aes(x=trt,y=rel)) +
  geom_boxplot(outlier.shape=NA) +
  geom_point(position="jitter") +
  ylim(0,100)

ap2 %>%  
  ggplot(aes(x=trt,y=rel)) +
  geom_boxplot(outlier.shape=NA) +
  geom_point(position="jitter") +
  ylim(0,100)
```

---

- Design 1: kleinere variabiliteit

- Design 2: grotere variabiliteit en lagere relatieve abundanties van *Staphylococcus*

- Wat is het beste design?

---

- Randomisatie is sterk gerelateerd met het concept van de populatie en scope van de studie.  

- Op basis van de steekproef kunnen de onderzoekers conclusies trekken over

    - Mannelijke studenten in de faculteit wetenschappen
    - Mensen van de Belgische populatie

- De scope van de studie moet goed worden omschreven voor de start van het experiment.

- Omdat de statistische analyse valide zou zijn is het noodzakelijk dat de subjecten volledig random worden getrokken van de populatie naar waar we onze conclusies wensen te veralgemenen.

- Volledig random trekken van de populatie impliceert dat:

    - alle subjecten van de populatie evenveel kans hebben om in de steekproef te worden opgenomen
    - de selectie van een subject onafhankelijk is van de andere subjecten in de steekproef.


- De steekproef is dan representatief voor de populatie, maar is nog steeds random.

- Wat betekent dit?

---

# Variabiliteit van steekproef tot steekproef

- Om te begrijpen dat een steekproef random is zouden we hetzelfde experiment veel keer moeten kunnen herhalen (`repeated sampling`).

- Dan zouden we inzicht kunnen krijgen hoe de gegevens veranderen van steekproef tot steekproef.

- Om dit te illustreren zullen we gebruik maken van een hele grote studie.

- Uit die studie zullen we dan herhaaldelijk kleine steekproeven trekken om te begrijpen hoe de gegevens en statistieken veranderen van steekproef tot steekproef. Of om met andere woorden na te gaan wat de variabiliteit is tussen steekproeven.

---

National Health NHanes study

  - Sinds 1960 worden elk jaar mensen van alle leeftijden geïnterviewd bij hen thuis.
  - Er maakt ook een gezondheidsonderzoek deel uit van de study die in een mobiel onderzoekscentrum wordt afgenomen.
  - We zullen deze grote studie gebruiken om at random personen te selecteren van de Amerikaanse populatie.
  - Dat zal inzicht geven in hoe de gegevens en resultaten van een analyse zullen variëren van steekproef tot steekproef.
  - De data van deze studie is terug te vinden in het R pakket `NHANES`

---

```{r}
library(NHANES)
head(NHANES)
glimpse(NHANES)
```

---

## Data exploratie


Stel dat we geïnteresseerd zijn om te onderzoeken hoe de directe cholestorol concentratie verschilt tussen mannen en vrouwen die ouder zijn dan 25 jaar.

1. We pipen de dataset naar de function `filter` om de data te filteren volgens leeftijd.  
2. We plotten de directe cholesterol metingen.
    - We selecteren de data data met het commando `ggplot(aes(x=DirectChol))`
    - We voegen een histogram toe met het commando `geom_histogram()`
    - We maken twee vertikale panels met het commando `facet_grid(Gender~.)`
    - We veranderen het label van de x-as met de `xlab` functie.

```{r}
NHANES%>%filter(Age>25)%>%
  ggplot(aes(x=DirectChol))+
  geom_histogram() +
  facet_grid(Gender~.) +
  xlab("Direct cholesterol (mg/dl)")
```

---

- Cholestorol metingen en concentratie metingen in het algemeen zijn vaak scheef verdeeld.
- Concentraties kunnen niet lager zijn dan 0.  
- Ze worden dikwijls log getransformeerd.

```{r}
NHANES%>%
  filter(Age>25)%>%
  ggplot(aes(x=DirectChol%>%log2))+
  geom_histogram() +
  facet_grid(Gender~.) +
  xlab("Direct cholesterol (log2)")
```

We zien dat de data nu min of meer symmetrisch verdeeld zijn en een klokvorm hebben.  
Dat zal ons toe laten om de data verder samen te vatten door gebruik te maken van twee statistieken: het gemiddelde en de standaard deviatie wat een maat is voor de spreiding van de (log-getransformeerde) gegevens rond het gemiddelde.

---

We maken nu een subset van de data die we zullen gebruiken om aan te tonen hoe de variabiliteit in kleine steekproeven kan variëren van steekproef tot steekproef.

  1. We filteren op leeftijd en verwijderen ontbrekenden gegevens (NA, Not Available).
  2. We selecteren enkel het geslacht en Direct Cholestorol zodat de dataset geen onnodige variabelen bevat.
  3. Met de functie mutate maken we een nieuwe variabele aan met de log getranformeerde directe cholestorol metingen.

```{r}
nhanesSub<- NHANES%>%
  filter(Age>25&!is.na(DirectChol)) %>%
  select(c("Gender","DirectChol")) %>%
  mutate(cholLog=log2(DirectChol))
```

---

We berekenen het gemiddelde en de standaard deviatie voor de cholLog variable voor mannen en vrouwen in de grote dataset.
We groeperen de data hiervoor op basis van het geslacht (variable Gender).


```{r}
cholLogSum <- nhanesSub %>%
  group_by(Gender) %>%
   summarize_at("cholLog",
               list(mean=mean,
                    sd=sd)
                )

cholLogSum
```

---

## Experiment

- Stel dat we geen toegang hebben tot de cholestorol niveau's van de Amerikaanse populatie.
- We zouden dan een experiment op moeten zetten om cholestorol metingen bij mannen en vrouwen te doen.
- Veronderstel dat we budget hebben om metingen bij 10 mannen en 10 vrouwen te doen.
- We zouden dan 10 mannen en 10 vrouwen boven de 25 jaar at random selecteren uit de Amerikaanse populatie.
- We kunnen dit experiment simuleren door 10 vrouwen en 10 mannen at random te bemonsteren uit de nhanes studie.

```{r}
fem <- nhanesSub %>%
  filter(Gender=="female") %>%
  sample_n(size=10)

mal <- nhanesSub %>%
  filter(Gender=="male") %>%
  sample_n(size=10)

samp <- rbind(fem,mal)
samp
```

---

We maken nu een histogram en een boxplot voor de data van het experiment.

```{r}
samp %>%
  ggplot(aes(x=cholLog)) +
  geom_histogram(binwidth = .1) +
  facet_grid(Gender~.) +
  xlab("Direct cholesterol (log2)")

samp %>%
  ggplot(aes(x=Gender,y=cholLog)) +
  geom_boxplot(outlier.shape=NA) +
  geom_point(position="jitter")
```

---

We vatten de data samen.

```{r}
cholLogSumExp1 <- samp %>%
   group_by(Gender) %>%
   summarize_at("cholLog",
               list(mean=mean,
                    sd=sd)
                )

cholLogSumExp1  
```

Merk op dat de gemiddelden anders zijn dan deze voor het grote experiment waarvan we de gegevens hebben gesampled.

```{r}
cholLogSum
cholLogSum$mean[2]-cholLogSum$mean[1]
```

Gezien de grootte van de steekproef (`r sum(nhanesSub$Gender=="female")` vrouwen en `sum(nhanesSub$Gender=="male")` mannen) in de NHANES studie zijn gemiddelden die we bekomen uit de volledige studie heel nauwkeurig. Wanneer we kleine steekproef trekken van volledige NHANES studie dan kunnen we veronderstellen dat we deze steekproef getrokken is uit een populatie waarvoor de het gemiddelde log cholestorol niveau voor mannen en vrouwen boven de 25 gelijk is aan deze bekomen op basis van de volledige NHANES studie.

In de "populatie" is de log cholestorol concentratie gemiddeld `r cholLogSum$mean[1]-cholLogSum$mean[2]` eenheden hoger bij vrouwen dan bij mannen.

We berekenen het verschil in gemiddelde tussen vrouwen en mannen op basis van de gegevens in ons experiment.

```{r}
cholLogSumExp1$mean[2]-cholLogSumExp1$mean[1]
```

Op basis van ons experiment schatten we dat de log cholestorol concentratie gemiddeld `r cholLogSumExp1$mean[1]-cholLogSumExp1$mean[2]` eenheden op log schaal `r ifelse(cholLogSumExp1$mean[1]>cholLogSumExp1$mean[2],"hoger","lager")` bij vrouwen dan bij mannen.

Indien we een statistische test uitvoeren (zie hoofdstuk 5: Statistische besluitvorming) kunnen we op basis van de kleine steekproef besluiten dat het gemiddeld cholestorol niveau op log schaal `r ifelse(t.test(cholLog~Gender,samp,var.equal=TRUE)$p.value < 0.05,"significant","niet significant")` verschillend is tussen mannen en vrouwen.

---

## Herhaal het experiment

Als we het experiment herhalen selecteren we andere mensen en verkrijgen we andere resultaten.


```{r}
fem<-nhanesSub%>%filter(Gender=="female")%>%sample_n(size=10)
mal<-nhanesSub%>%filter(Gender=="male")%>%sample_n(size=10)

samp2<-rbind(fem,mal)

samp2%>%
  ggplot(aes(x=Gender,y=cholLog)) +
  geom_boxplot(outlier.shape=NA) +
  geom_point(position="jitter")

cholLogSumExp2 <- samp2 %>%
  group_by(Gender) %>%
  summarize_at("cholLog",
                 list(mean=mean,
                      sd=sd)
                  )

cholLogSumExp2
```

Op basis van het tweede experiment schatten we dat de log cholestorol concentratie gemiddeld `r cholLogSumExp2$mean[1]-cholLogSumExp2$mean[2]` eenheden op log schaal `r ifelse(cholLogSumExp2$mean[1]>cholLogSumExp2$mean[2],"hoger","lager")` bij vrouwen dan bij mannen.

Indien we een statistische test uitvoeren (zie hoofdstuk 5: Statistische besluitvorming) kunnen we op basis van de kleine steekproef besluiten dat het gemiddeld cholestorol niveau op log schaal `r ifelse(t.test(cholLog~Gender,samp2,var.equal=TRUE)$p.value < 0.05,"significant","niet significant")` verschillend is tussen mannen en vrouwen.


---

## And again

```{r}
set.seed(12857)
fem <- nhanesSub%>%filter(Gender=="female")%>%sample_n(size=10)
mal <- nhanesSub%>%filter(Gender=="male")%>%sample_n(size=10)

samp3<-rbind(fem,mal)

samp3%>%
  ggplot(aes(x=Gender,y=cholLog)) +
  geom_boxplot(outlier.shape=NA) +
  geom_point(position="jitter")

cholLogSumExp3 <- samp3 %>%
  group_by(Gender) %>%
  summarize_at("cholLog",
                   list(mean=mean,
                        sd=sd)
                    )

cholLogSumExp3
```

Op basis van het derde experiment schatten we dat de log cholestorol concentratie gemiddeld `r cholLogSumExp3$mean[1]-cholLogSumExp3$mean[2]` eenheden op log schaal `r ifelse(cholLogSumExp3$mean[1]>cholLogSumExp3$mean[2],"hoger","lager")` bij vrouwen dan bij mannen !?

Indien we een statistische test uitvoeren (zie hoofdstuk 5: Statistische besluitvorming) kunnen we op basis van de kleine steekproef besluiten dat het gemiddeld cholestorol niveau op log schaal `r ifelse(t.test(cholLog~Gender,samp3,var.equal=TRUE)$p.value < 0.05,"significant","niet significant")` verschillend is tussen mannen en vrouwen.

---

## Summary

- Omdat we at random andere proefpersonen in elke steekproef selecteren uit de populatie bekomen we andere cholestorol concentraties.

- Hierdoor zullen niet enkel de cholestorol niveaus van steekproef tot steekproef van elkaar verschillen maar ook de gemiddeldend, de standaard deviates en de standaard errors.

- Merk op dat in de laatste steekproef de cholestorol concentratie op log schaal gemiddeld lager was voor vrouwne dan voor mannen, terwijl dat omgekeerd is in de populatie. Bovendien was dit verschil statistisch significant waardoor we op basis van deze steekproef foutief zouden concluderen dat het gemiddeld cholestorol niveau voor vrouwen statistisch significant lager is dan voor mannen.

- Dat impliceert dat ook onze conclusies onzeker zijn en van steekproef tot steekproef kunnen wijzigen.

- Steekproeven waarbij het effect omkeert en waarbij we besluiten dat het verschil significant is zijn heel zeldzaam. Omdat we met statistiek net de kans op het trekken foute conclusies gaan proberen te controleren.

- Dit wordt in de onderstaande code geïllustreerd. We trekken 20000 herhaalde steekproeven van 10 vrouwen en 10 mannen uit de NHANES studie.

```{r}
# Aantal simulaties en steekproefgrootte per groep
nSim <- 20000
nSamp <- 10

# We filteren de data vooraf zodat we dit niet telkens opnieuw hoeven te doen
fem<-nhanesSub%>%filter(Gender=="female")
mal<-nhanesSub%>%filter(Gender=="male")

# Simulatie studie
# Om snelle functies te kunnen gebruiken nemen we eerst nSim steekproeven en berekenen we daarna alles.

femSamps <- malSamps <-matrix(NA,nrow=nSamp,ncol=nSim)
for (i in 1:nSim)
{
  femSamps[,i] <- sample(fem$cholLog,nSamp)
  malSamps[,i] <- sample(mal$cholLog,nSamp)
}

res <- data.frame(
  verschil=colMeans(femSamps) - rowMeans(malSamps),
  Rfast::ttests(femSamps,malSamps)
  )

sum(res$pvalue<0.05&res$verschil>0)
sum(res$pvalue>=0.05)
sum(res$pvalue<0.05&res$verschil<0)


res %>%
  ggplot(aes(x=verschil,y=-log10(pvalue),color=pvalue<0.05)) +
  geom_point() +
  xlab("Gemiddeld Verschil (log2)") +
  ylab("Statistische Significantie")

res %>%
  ggplot(aes(y=verschil)) +
  geom_boxplot() +
  geom_point(aes(x=0,y=c(mean(fem$cholLog)-mean(mal$cholLog)),color="Pop. Verschil"),size=3,pch=17) +
  ylab("Gemiddeld Verschil (log2)")
  xlab("")
```

Enkel in `r sum(res$pvalue<0.05&res$verschil<0)` van de 20000 steekproeven zouden we concluderen we dat het gemiddeld cholesterol concentratie van mannen significant hoger is dan van vrouwen.   
Voor de overige steekproeven  is de cholesterol concentratrie voor mannen gemiddeld significant lager dan voor vrouwen (`r sum(res$pvalue<0.05&res$verschil>0)` steekproeven) of is het gemiddeld verschil statistisch niet significant (`r sum(res$pvalue>=0.05)` steekproeven).
Het feit dat we in veel steekproeven resultaten vinden die statistisch niet significant zijn komt omdat de statistische toets een te lage kracht heeft om het verschil te detecteren wanneer er maar 10 observaties zijn per groep.

---

## Grotere steekproef?

Wat gebeurt er als we de steekproef verhogen naar 50 observaties per groep?

```{r}
nSim <- 20000
nSamp <- 50

# We filteren de data vooraf zodat we dit niet telkens opnieuw hoeven te doen
fem<-nhanesSub%>%filter(Gender=="female")
mal<-nhanesSub%>%filter(Gender=="male")

# Simulatie studie
# Om snelle functies te kunnen gebruiken nemen we eerst nSim steekproeven en berekenen we daarna alles.

femSamps <- malSamps <-matrix(NA,nrow=nSamp,ncol=nSim)
for (i in 1:nSim)
{
  femSamps[,i] <- sample(fem$cholLog,nSamp)
  malSamps[,i] <- sample(mal$cholLog,nSamp)
}

res <- data.frame(
  verschil=colMeans(femSamps) - rowMeans(malSamps),
  Rfast::ttests(femSamps,malSamps)
  )

sum(res$pvalue<0.05&res$verschil>0)
sum(res$pvalue>=0.05)
sum(res$pvalue<0.05&res$verschil<0)


res %>%
  ggplot(aes(x=verschil,y=-log10(pvalue),color=pvalue<0.05)) +
  geom_point() +
  xlab("Gemiddeld Verschil (log2)") +
  ylab("Statistische Significantie")

res %>%
  ggplot(aes(y=verschil)) +
  geom_boxplot() +
  geom_point(aes(x=0,y=c(mean(fem$cholLog)-mean(mal$cholLog)),color="Pop. Verschil"),size=3,pch=17) +
  ylab("Gemiddeld Verschil (log2)")
  xlab("")
```

---

# Salk Study

- In 1916, brak de eerste grote polio epidemie uit in de USA.
- Begin de jaren 50 ontwikkelde John Salk een vaccin met belovende resultaten in het lab.
- In 1954, heeft de National Foundation
for Infantile Paralysis (NFIP) een grote studie opgezet om de effectiviteit van het Salk vaccin na te gaan.
- Veronderstel dat de NFIP in 1954 een groot aantal kinderen zou hebben gevaccineerd, wat zouden ze dan kunnen besluiten als de polio incidentie in 1954 lager was dan in 1953?

---

## NFIP Study
### Design

- Grote simultane studie met gevaccineerde kinderen (cases) en ongevaccineerde kinderen (controles).
- In scholen van districten met hoge polio incidentie.
- Cases: kinderen van de tweede graad van het lager onderwijs waarvan de ouders toestemden met vaccinatie.
- Controles: kinderen van de eerste en derde graad.

### Data
```{r}
nfip<-data.frame(group=c("cases","controls","noConcent"),grade=c("g2","g1g3","g2"),vaccin=c("yes","no","no"),total=c(221998,725173,123605),polio=c(54,391,56))
nfip$noPolio<-nfip$total-nfip$polio
knitr::kable(nfip)
```

Vergelijk de polio incidentie?

---

```{r}
nfip$incidencePM<-round(nfip$polio/nfip$total*1e6,0)
knitr::kable(nfip)
```

Wat kunnen we concluderen?

---

## Confounding


```{r,echo=FALSE, fig.align = "center",out.width = '50%'}
plot(c(0,0,1),c(-2,2,0),pch=c("S","V","P"),xaxt="none",yaxt="none",axes=FALSE,xlab="",ylab="",cex=4,ylim=c(-2.2,2.2))
arrows(x0=0.1,x1=.9,y0=1.8,y1=0.1,lwd=4)
arrows(x0=0.1,x1=.9,y0=-1.8,y1=-0.2,lwd=4)
arrows(x0=0,x1=0,y0=-1.4,y1=1.4,lwd=4)
```


- We observeren een lagere polio (P) incidentie voor kinderen bij wie de ouders geen toestemming gaven dan in de controle groep.  

- Toestemming voor vaccinatie (V) is geassocieerd met de socio-economische status (S).

- Kinderen van lagere socio-economische status zijn meer resistent tegen de ziekte.

- De groepen van cases en controles zijn niet vergelijkbaar
    - verschil in leeftijd
    - verschil in socio-economische status en
    - verschil in vatbaarheid voor de ziekte.

---

## Salk Study

### Design
Een nieuwe studie werd uitgevoerd: dubbel blinde gerandomiseerde studie.

  - Kinderen worden at random toegewezen aan controle of case arm van het experiment nadat de ouders toestemden met vaccinatie.
  - Controle: vaccinatie met placebo
  - Treatment: vaccinatie met vaccine
  - double blinding:
    - ouders en kinderen weten niet of ze werden gevaccineerd of niet
    - medische staf en onderzoekers weten niet of het kind het vaccin of de placebo kreeg

---

### Data

```{r}
salk<-data.frame(group=c("cases","control","noConcent"),treatment=c("vaccine","placebo","none"),total=c(200745,
201229, 338778),polio=c(57,142,157))
salk$noPolio<-salk$total-salk$polio
salk$incidencePM<-round(salk$polio/salk$total*1e6,0)
knitr::kable(salk)
```

- We observeren en veel groter effect nu dat cases en controles vergelijkbaar zijn, incidentie van respectievelijk `r salk$incidencePM[1]`  and `r salk$incidencePM[2]` per miljoen.

- De polio incidentie voor kinderen die geen toestemming geven blijft vergelijkbaar  `r nfip$incidencePM[3]` and `r salk$incidencePM[3]` per miljoen respectievelijk in the NFIP and Salk study.

---

# Wetenschappelijke methode

- Empirische data zijn cruciaal in de wetenschappen.  
- Onderzoek wordt tegenwoordig gedreven door data .

```{r,echo=FALSE, fig.align = "center"}
plot(0,0,col=0,xaxt="none",yaxt="none",axes=FALSE,xlab="",ylab="",cex=4,ylim=c(-.5,1.5),xlim=c(-.5,1.5))
lines(c(0,1),c(0,0),lwd=4)
lines(c(0,.5),c(0,1),lwd=4)
lines(c(.5,1),c(1,0),lwd=4)
text(0.5,1.2,"Nature",cex=2)
text(0.8,.5,"Experiment",cex=2,pos=4,col="darkred")
text(1,0,"Data",cex=2,pos=4)
text(0.2,.5,"Theory",cex=2,pos=2,col="darkred")
text(0,0,"Model",cex=2,pos=2)
text(0.5,-0.3,"Statistical\nInference",cex=2,col="darkred")
```

- *Natuur*: proces die we bestuderen

- *Deductie*: leid logische gevolgen af van een theorie of hypothese die experimenteel kan worden gevalideerd.

- *Experiment*:  verzamel data over het proces. De data zijn een manifestatie van het werkelijk onderliggende proces. Het experiment moet *representatief* en *reproduceerbaar* zijn en moet de theorie/hypothese uitdagen. *Experimenteel Design*!

- *Statistische besluitvorming (inferentie)*: brug om model/hypothese te confronteren met de data: is de *sluitsteen van de wetenschappelijke methode*

- *Falsificatie principe*: Data can niet worden gebruikt om een hypothese te bewijzen, ze kan een hypothese enkel ontkrachten.

- *Data-exploratie en analyse* wordt gebruik om de theorie te verfijnen en om nieuwe hypotheses te genereren.

---

# Rol van Statistiek

- We hebben gezien dat
    - het belangrijk is om de scope van de studie goed te specifiëren voor de start van het experiment.
    - steekproef grootte is heel belangrijk
    - we moeten ons bewust zijn van Confounding
    - een goede controle is belangrijk


$\rightarrow$ Goede proefopzet is cruciaal!

- We hebben ook geobserveerd dat er variabiliteit is in de populatie en dat zorgt voor onzekerheid in de resultaten en de conclusies van een analyse omdat we slechts een kleine steekproef kunnen nemen uit de populatie.




- Statistiek is de wetenschap voor het
    1. verzamelen (experimenteel design),
    2. exploren (data exploration) en
    3. leren van data zodat we hetgeen we observeren in de steekproef zouden kunnen veralgemenen naar de populatie terwijl we de onzekerheid quantificeren, controleren en rapporteren (statistisch modelleren en statistische besluitvorming).

- Statistiek speelt daarom een heel belangrijke rol in zowat alle wetenschappen (zie bijvoorbeeld de column "points of significance" in het hoog aangeschreven tijdschrift Nature Methods. http://blogs.nature.com/methagora/2013/08/giving_statistics_the_attention_it_deserves.html)

---

```{r pop2Samp2Pop, out.width='80%',fig.asp=.8, fig.align='center',echo=FALSE}
if ("pi"%in%ls()) rm("pi")
kopvoeter<-function(x,y,angle=0,l=.2,cex.dot=.5,pch=19,col="black")
{
angle=angle/180*pi
points(x,y,cex=cex.dot,pch=pch,col=col)
lines(c(x,x+l*cos(-pi/2+angle)),c(y,y+l*sin(-pi/2+angle)),col=col)
lines(c(x+l/2*cos(-pi/2+angle),x+l/2*cos(-pi/2+angle)+l/4*cos(angle)),c(y+l/2*sin(-pi/2+angle),y+l/2*sin(-pi/2+angle)+l/4*sin(angle)),col=col)
lines(c(x+l/2*cos(-pi/2+angle),x+l/2*cos(-pi/2+angle)+l/4*cos(pi+angle)),c(y+l/2*sin(-pi/2+angle),y+l/2*sin(-pi/2+angle)+l/4*sin(pi+angle)),col=col)
lines(c(x+l*cos(-pi/2+angle),x+l*cos(-pi/2+angle)+l/2*cos(-pi/2+pi/4+angle)),c(y+l*sin(-pi/2+angle),y+l*sin(-pi/2+angle)+l/2*sin(-pi/2+pi/4+angle)),col=col)
lines(c(x+l*cos(-pi/2+angle),x+l*cos(-pi/2+angle)+l/2*cos(-pi/2-pi/4+angle)),c(y+l*sin(-pi/2+angle),y+l*sin(-pi/2+angle)+l/2*sin(-pi/2-pi/4+angle)),col=col)
}

par(mar=c(0,0,0,0),mai=c(0,0,0,0))
plot(0,0,xlab="",ylab="",xlim=c(0,10),ylim=c(0,10),col=0,xaxt="none",yaxt="none",axes=FALSE)
rect(0,6,10,10,border="red",lwd=2)
text(.5,8,"population",srt=90,col="red",cex=2)
symbols (3, 8, circles=1.5, col="red",add=TRUE,fg="red",inches=FALSE,lwd=2)
set.seed(330)
grid=seq(0,1.3,.01)

for (i in 1:50)
{
	angle1=runif(n=1,min=0,max=360)
	angle2=runif(n=1,min=0,max=360)
	radius=sample(grid,prob=grid^2*pi/sum(grid^2*pi),size=1)
	kopvoeter(3+radius*cos(angle1/180*pi),8+radius*sin(angle1/180*pi),angle=angle2)
}
text(7.5,8,"cholesterol in population",col="red",cex=1.2)

rect(0,0,10,4,border="blue",lwd=2)
text(.5,2,"sample",srt=90,col="blue",cex=2)
symbols (3, 2, circles=1.5, col="red",add=TRUE,fg="blue",inches=FALSE,lwd=2)
for (i in 0:2)
	for (j in 0:4)
{

	kopvoeter(2.1+j*(3.9-2.1)/4,1.1+i)
}
text(7.5,2,"cholesterol in sample",col="blue",cex=1.2)

arrows(3,5.9,3,4.1,col="black",lwd=3)
arrows(7,4.1,7,5.9,col="black",lwd=3)
text(1.5,5,"EXP. DESIGN (1)",col="black",cex=1.2)
text(8.5,5,"ESTIMATION &\nINFERENCE (3)",col="black",cex=1.2)
text(7.5,.5,"DATA EXPLORATION &\nDESCRIPTIVE STATISTICS (2)",col="black",cex=1.2)
```


---

# [Home](https://gtpb.github.io/sbc20/) {-}
