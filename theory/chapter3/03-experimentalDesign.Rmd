---
title: "3. Enkele concepten van experimenteel design"
author: "Lieven Clement"
date: "statOmics, Ghent University (https://statomics.github.io)"
output:
    html_document:
      code_download: true
      theme: cosmo
      toc: true
      toc_float: true
      highlight: tango
      number_sections: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(include = TRUE, comment = NA, echo = TRUE,
                      message = FALSE, warning = FALSE)
library(tidyverse)
library(NHANES)
```

```{r pop2Samp2Pop, out.width='80%',fig.asp=.8, fig.align='center',echo=FALSE}
if ("pi"%in%ls()) rm("pi")
kopvoeter<-function(x,y,angle=0,l=.2,cex.dot=.5,pch=19,col="black")
{
angle=angle/180*pi
points(x,y,cex=cex.dot,pch=pch,col=col)
lines(c(x,x+l*cos(-pi/2+angle)),c(y,y+l*sin(-pi/2+angle)),col=col)
lines(c(x+l/2*cos(-pi/2+angle),x+l/2*cos(-pi/2+angle)+l/4*cos(angle)),c(y+l/2*sin(-pi/2+angle),y+l/2*sin(-pi/2+angle)+l/4*sin(angle)),col=col)
lines(c(x+l/2*cos(-pi/2+angle),x+l/2*cos(-pi/2+angle)+l/4*cos(pi+angle)),c(y+l/2*sin(-pi/2+angle),y+l/2*sin(-pi/2+angle)+l/4*sin(pi+angle)),col=col)
lines(c(x+l*cos(-pi/2+angle),x+l*cos(-pi/2+angle)+l/2*cos(-pi/2+pi/4+angle)),c(y+l*sin(-pi/2+angle),y+l*sin(-pi/2+angle)+l/2*sin(-pi/2+pi/4+angle)),col=col)
lines(c(x+l*cos(-pi/2+angle),x+l*cos(-pi/2+angle)+l/2*cos(-pi/2-pi/4+angle)),c(y+l*sin(-pi/2+angle),y+l*sin(-pi/2+angle)+l/2*sin(-pi/2-pi/4+angle)),col=col)
}

par(mar=c(0,0,0,0),mai=c(0,0,0,0))
plot(0,0,xlab="",ylab="",xlim=c(0,10),ylim=c(0,10),col=0,xaxt="none",yaxt="none",axes=FALSE)
rect(0,6,10,10,border="red",lwd=2)
text(.5,8,"population",srt=90,col="red",cex=2)
symbols (3, 8, circles=1.5, col="red",add=TRUE,fg="red",inches=FALSE,lwd=2)
set.seed(330)
grid=seq(0,1.3,.01)

for (i in 1:50)
{
	angle1=runif(n=1,min=0,max=360)
	angle2=runif(n=1,min=0,max=360)
	radius=sample(grid,prob=grid^2*pi/sum(grid^2*pi),size=1)
	kopvoeter(3+radius*cos(angle1/180*pi),8+radius*sin(angle1/180*pi),angle=angle2)
}
text(7.5,8,"Lengte in populatie",col="red",cex=1.2)

rect(0,0,10,4,border="blue",lwd=2)
text(.5,2,"sample",srt=90,col="blue",cex=2)
symbols (3, 2, circles=1.5, col="red",add=TRUE,fg="blue",inches=FALSE,lwd=2)
for (i in 0:2)
	for (j in 0:4)
{

	kopvoeter(2.1+j*(3.9-2.1)/4,1.1+i)
}
text(7.5,2,"Lengte in sample",col="blue",cex=1.2)

arrows(3,5.9,3,4.1,col="black",lwd=3)
arrows(7,4.1,7,5.9,col="black",lwd=3)
text(1.5,5,"EXP. DESIGN (1)",col="black",cex=1.2)
text(8.5,5,"SCHATTING &\nINFERENTIE (3)",col="black",cex=1.2)
text(7.5,.5,"DATA EXPLORATIE &\nBESCHRIJVENDE STATISTIEK (2)",col="black",cex=1.2)
```

---

#Nood aan een goeie controle

- Een goede controle groep is cruciaal.

- Om het effect van een interventie te evalueren is het noodzakelijk om de behandelingsgroep te vergelijken met een controle groep.

- We moeten ons bewust zijn van Confounding

- Groepen in een observationele studie zijn dikwijls niet vergelijkbaar. Geavanceerde statistische methodel zijn nodig om causale verbanden te kunnen trekken.

- Double blinding

- Gerandomiseerde studies: random toewijzing van subjecten tot de verschillende behandelingsarmen van een studie $\rightarrow$ vergelijkbare groepen.

---

# Randomizatie

- Randomizatie compleet at random (no systematic allocation).

## Simpele Randomizatie

- Kan leiden tot verschillen in aantal subjecten per  behandelingsarm

- in 5% of van de steekproeven zien we een imbalans van
    - minstens 60:40 in een studie met 100 subjecten, en
    - van minstens 531:469 in een studie met 1000 subjecten.

- The imbalans is niet problematisch, maar zorgt voor een verlies in precisie op de schatters (vb. gemiddelden).

---

## Gebalanceerde Randomisatie

- Gelijke aantallen van elke behandeling worden toegekend aan een blok van 2, 4 of meer subjecten.
    - (1) AB, (2) BA
    - (1) AABB, (2) ABAB, (3) ABBA, (4) BABA, (5) BAAB, (6) BBAA
    - ...

- Gebalanceerde Randomizatie verzekert $\pm$ gelijk aantal subjecten in elke behandelingsarm van het experiment (vb controle en behandelingsgroep).

- Zorgt er niet voor dat we een gelijk aantal mannen en vrouwen hebben in elke groep, etc.  

- In kleine studies kunnen de groepen ongebalanceerd zijn in andere karakteristieken (e.g. gender, afkomst, leeftijd ...)

- Dat is niet problematisch omdat het at random gebeurt, maar het zorgt opnieuw voor een verlies in precisie.

---

## **Gestratificeerde Randomisatie**

- De imbalans voor bijvoorbeeld gender kan worden vermeden door gestratificeerde randomisatie: gebalanceerde randomisatie per stratum

![Stratified Randomizatie](https://github.com/statOmics/sbc20/raw/master/theory/figures/stratification.png){ width=50% }

---

# Blok Designs

##Gene expression example

- dm: diabetic medium, nd: non diabetic medium, co: control
- 4 bio-repeats, 2 technische repeats/biorep
![](https://github.com/statOmics/sbc20/raw/master/theory/figures/qpcrBadDesign1.png){ width=100% }

- dm: diabetic medium, nd: non diabetic medium, co: control
- 4 bio-reps, 2 techreps/biorep, 2 plates A & B
- Treatment and plate almost entirely confounded

![](https://github.com/statOmics/sbc20/raw/master/theory/figures/qpcrBadDesign2.png){ width=100% }

## Nature methods: Points of significance - Blocking

![](https://www.nature.com/articles/nmeth.3005.pdf){ width=100% }


---

## Randomized complete block designs

- Experimentele designs waarbij experimentele subjecten eerst worden opgedeeld in blokken
- Vervolgens wordt elk niveau van de interventie binnen elk blok toepast en via randomisatie toegewezen.
- Dat kan b.v. d.m.v. gestratificeerde randomisatie: stratificatie volgens blokken
- Vaak wanneer uitkomst sterk varieert tussen subjecten zodat interventie-effect moeilijk op te pikken is
- Als gegevens veel minder variabel zijn per blok, laat randomiseren van de interventie per blok toe om  interventie-effect binnen blok te evalueren met veel minder ruis.
- Ook vaak gebruikt bij technische variabiliteit.
    - Vb grotere experimenten: meerdere celculturen nodig, niet alles kan tegelijk in lab, meerdere sequeneringsruns om genexpressie te meten
    - Fluctuaties in de labo-condities , tussen celculturen of van sequeneringsrun tot sequeneringsrun zorgen voor extra technische ruis.
    - Blokken (vb. tijdstippen, runs, celculturen) en behandelingen randomizeren binnen elk blok
    - opnieuw kan interventie-effecten met veel minder ruis worden geschat.

---

# Steekproef grootte

- De steekproefgrootte en het design zijn cruciaal

- Hoe groter de steekproef hoe meer precies de resultaten! Zie introductie


---

# [Home](https://gtpb.github.io/PSLS20/) {-}
